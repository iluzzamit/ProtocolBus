{"version":3,"file":"CANBusRouter.js","sourceRoot":"","sources":["../../src/route/CANBusRouter.ts"],"names":[],"mappings":"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","sourcesContent":["import { Router } from \"express\";\r\nimport CANBus from \"../ctrl/CANBus\";\r\nimport { Events, Log } from \"../model/Log\";\r\n\r\n/*\r\n    2 API Routes,\r\n        [get] api/can-bus gets last 100 messages.\r\n        [put] api/can-bus/toggle-generator toggle the generator.\r\n*/\r\n\r\nexport function initialCANBusRouter(app, canBus: CANBus) {\r\n    const canBusRouter = Router();\r\n    app.use(canBusRouter);\r\n\r\n    canBusRouter.get('/api/can-bus/', (req, res) => {\r\n        try {\r\n            const data = canBus.getReporterData().slice(0,100);\r\n\r\n            res.status(200).send(data);\r\n        } catch (e) {\r\n            const log: Log = new Log(Events.failedToGetDataAPI, e);\r\n            canBus.logger.add(log);\r\n            console.log(log);\r\n            res.status(400).send(log);\r\n        }\r\n    });\r\n\r\n    canBusRouter.get('/api/can-bus/is-generating', (req, res) => {\r\n        try {\r\n            const data = canBus.isGenerating();\r\n\r\n            res.status(200).send(data);\r\n        } catch (e) {\r\n            const log: Log = new Log(Events.failedToGetDataAPI, e);\r\n            canBus.logger.add(log);\r\n            console.log(log);\r\n            res.status(400).send(log);\r\n        }\r\n    });\r\n\r\n    canBusRouter.get('/api/can-bus/get-logs', (req, res) => {\r\n        try {\r\n            const data = canBus.getLogs().slice(0,100);\r\n\r\n            res.status(200).send(data);\r\n        } catch (e) {\r\n            const log: Log = new Log(Events.failedToGetLogs, e);\r\n            canBus.logger.add(log);\r\n            console.log(log);\r\n            res.status(400).send(log);\r\n        }\r\n    });\r\n\r\n    canBusRouter.put('/api/can-bus/toggle-generator', (req, res) => {\r\n        try{\r\n            const result = canBus.isGenerating();\r\n            result ? canBus.stopGenerator() : canBus.startGenerator();\r\n\r\n            res.status(200).send();\r\n        }catch(e) {\r\n            const log: Log = new Log(Events.failedToToggleGeneratorAPI, e);\r\n            canBus.logger.add(log);\r\n            console.log(log);\r\n            res.status(400).send(log);\r\n        }\r\n    });\r\n}"]}