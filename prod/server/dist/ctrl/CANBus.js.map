{"version":3,"file":"CANBus.js","sourceRoot":"","sources":["../../src/ctrl/CANBus.ts"],"names":[],"mappings":";;AAGA,2CAA6C;AAI7C,sCAA2C;AAG3C,MAAqB,MAAM;IACzB,YACS,SAA0B,EAC1B,QAAwB,EACxB,QAAwB,EACxB,MAAc,EACd,aAAkB;QAJlB,cAAS,GAAT,SAAS,CAAiB;QAC1B,aAAQ,GAAR,QAAQ,CAAgB;QACxB,aAAQ,GAAR,QAAQ,CAAgB;QACxB,WAAM,GAAN,MAAM,CAAQ;QACd,kBAAa,GAAb,aAAa,CAAK;QAKnB,qBAAgB,GAAG,CAAC,KAAa,EAAQ,EAAE;YACjD,IAAI;gBACF,MAAM,UAAU,GAAe,kBAAU,CAAC,KAAK,CAAC,CAAC;gBACjD,MAAM,CAAC,eAAe,EAAE,iBAAiB,CAAC,GACxC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;gBAEnC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,iBAAiB,EAAE,eAAe,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;aAC/E;YAAC,OAAO,CAAC,EAAE;gBACV,MAAM,GAAG,GAAQ,IAAI,SAAG,CAAC,YAAM,CAAC,mBAAmB,EAAE,CAAC,CAAC,CAAC;gBACxD,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;gBACrB,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;aAClB;QACH,CAAC,CAAC;QAfA,MAAM,CAAC,SAAS,CAAC,aAAa,CAAC,CAAC;IAClC,CAAC;IAgBD,cAAc;QACZ,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QAC5C,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,SAAG,CAAC,YAAM,CAAC,cAAc,CAAC,CAAC,CAAC;IAClD,CAAC;IAED,aAAa;QACX,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC;QACtB,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,SAAG,CAAC,YAAM,CAAC,aAAa,CAAC,CAAC,CAAC;IACjD,CAAC;IAED,YAAY;QACV,OAAO,IAAI,CAAC,SAAS,CAAC,YAAY,EAAE,CAAC;IACvC,CAAC;IAED,eAAe;QACb,OAAO,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,CAAC;IACjC,CAAC;IAED,OAAO;QACL,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;IAC3B,CAAC;CACF;AA9CD,yBA8CC","sourcesContent":["import CANBusGenerator from \"../bl/CANBusGenerator\";\r\nimport CANBusDetector from \"../bl/CANBusDetector\";\r\nimport { CANMessage } from \"../model/CANMessage\";\r\nimport { canDecoder } from \"../common/utils\";\r\nimport { DetectionResult } from \"../model/DetectionResult\";\r\nimport { CANBusReporter } from \"../bl/CANReporter\";\r\nimport { HistoryCANMessage } from \"../model/HistoryCANMessage\";\r\nimport { Events, Log } from \"../model/Log\";\r\nimport { Logger } from \"../bl/Logger\";\r\n\r\nexport default class CANBus {\r\n  constructor(\r\n    public generator: CANBusGenerator,\r\n    public detector: CANBusDetector,\r\n    public reporter: CANBusReporter,\r\n    public logger: Logger,\r\n    public canBusEmitter: any\r\n  ) {\r\n    logger.setSocket(canBusEmitter);\r\n  }\r\n\r\n  private onFrameGenerated = (frame: string): void => {\r\n    try {\r\n      const canMessage: CANMessage = canDecoder(frame);\r\n      const [detectionResult, historyCanMessage]: [DetectionResult, HistoryCANMessage] =\r\n        this.detector.detect(canMessage);\r\n\r\n      this.reporter.addData(historyCanMessage, detectionResult, this.canBusEmitter);\r\n    } catch (e) {\r\n      const log: Log = new Log(Events.failedToDetectFrame, e);\r\n      this.logger.add(log);\r\n      console.log(log);\r\n    }\r\n  };\r\n\r\n  startGenerator(): void {\r\n    this.generator.start(this.onFrameGenerated);\r\n    this.logger.add(new Log(Events.StartGenerator));\r\n  }\r\n\r\n  stopGenerator(): void {\r\n    this.generator.stop();\r\n    this.logger.add(new Log(Events.StopGenerator));\r\n  }\r\n\r\n  isGenerating(): boolean {\r\n    return this.generator.isGenerating();\r\n  }\r\n\r\n  getReporterData(): any[] {\r\n    return this.reporter.getData();\r\n  }\r\n\r\n  getLogs(): Log[] {\r\n    return this.logger.get();\r\n  }\r\n}\r\n"]}